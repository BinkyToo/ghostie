
<!doctype html>
<html>
    <head>
	<meta charset="UTF-8" />
	<title>P2 test</title>
	<script src="phaser.js"></script>
    </head>
    <body>

    <script type="text/javascript">

    window.onload = function() {

	var game = new Phaser.Game(800, 600, Phaser.CANVAS, 'phaser-example', { preload: preload, create: create, update: update });

	function preload() {
	    game.load.spritesheet('ghost', 'ghost-wavey.png', 40, 80, 8);
	    game.load.image('background', 'darkrock.png');
	    game.load.image('log', '1x3log.png');

	}

	var sprite1;
	var sprite2;
	var sprite3;

	function create() {
	    game.physics.startSystem(Phaser.Physics.P2JS);
	    
	    var background = game.add.tileSprite(0, 0, 800, 600, 'background', 0);

	    game.physics.p2.gravity.y = 300;

	    var spriteMaterial = game.physics.p2.createMaterial('spriteMaterial');
	    var worldMaterial = game.physics.p2.createMaterial('worldMaterial');
	    var contactMaterial = game.physics.p2.createContactMaterial(spriteMaterial, worldMaterial, { restitution: 0.2 });

	    ghost = game.add.sprite(game.world.centerX, game.world.centerY, 'ghost');
	    game.physics.enable(ghost, Phaser.Physics.P2JS);
	    var wave = ghost.animations.add('wave');
	    ghost.animations.play('wave', 25, true);
	    ghost.body.fixedRotation = true;
	    ghost.body.restitution = 1;
	    
	    game.physics.p2.setWorldMaterial(worldMaterial);

	    log1 = game.add.sprite(200, 80, 'log');
	    log2 = game.add.sprite(210, 100, 'log');

	    //  Enable for physics. This creates a default rectangular body.
	    game.physics.p2.enable([ log1, log2 ]);

	    log1.body.setMaterial(spriteMaterial);
	    log2.body.setMaterial(spriteMaterial);

	    cursors = game.input.keyboard.createCursorKeys();

	}
	function update() {
	    ghost.angle = ghost.body.velocity.x / 15
	    ghost.scale.setTo(1+Math.abs(ghost.body.velocity.x/2000), 1+Math.abs(ghost.body.velocity.y/1000))

	    if (cursors.left.isDown)
	    {
		if (ghost.body.velocity.x >= -400) {
		  ghost.body.velocity.x -= 10;
		}
		ghost.body.moveDown(40);

	    }
	    else if (cursors.right.isDown)
	    {
		if (ghost.body.velocity.x <= 400) {
		  ghost.body.velocity.x += 10;
		}
		ghost.body.moveDown(40);

	    }

	    else if (cursors.up.isDown)
	    {
		ghost.body.moveUp(40);
	    }


	}
	
	    };

    </script>

    </body>
</html>